<template>
  <div class="app-container home">
    <el-row :gutter="16" class="intro-row">
      <el-col :sm="24" :lg="12">
        <h2>RuoYi AI Quick Starter</h2>
        <p>
          RuoYi AI Quick Starter æ˜¯åŸºäº RuoYi çš„ <strong>AI å¿«é€Ÿå¼€å‘æ¡†æ¶</strong>ï¼ŒAI å‹å¥½è®¾è®¡ï¼Œå‰åç«¯å·¥ç¨‹ç»Ÿä¸€åœ¨åŒä¸€ä»“åº“ï¼Œä¾¿äº AI ç†è§£å®Œæ•´ä¸šåŠ¡ä¸Šä¸‹æ–‡ï¼Œå®ç°å…¨æ ˆå¼€å‘ã€‚å¯å¿«é€Ÿç”Ÿæˆæ¨¡å—å®Œæ•´ä»£ç ï¼ˆæ•°æ®åº“è¡¨ã€åç«¯æ¥å£ã€å‰ç«¯é¡µé¢ã€API å¯¹æ¥ï¼‰ã€‚
        </p>
        <p>
          ä¿ç•™å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œç¡®ä¿ä»£ç å¯ç»´æŠ¤æ€§å’Œå›¢é˜Ÿåä½œçµæ´»æ€§ã€‚å†…ç½®ç”¨æˆ·æƒé™ç®¡ç†ã€ç³»ç»Ÿç›‘æ§ã€å®šæ—¶ä»»åŠ¡ã€æ“ä½œæ—¥å¿—ç­‰ä¼ä¸šçº§åŠŸèƒ½æ¨¡å—ï¼Œå¼€ç®±å³ç”¨ï¼ŒåŠ©åŠ›é«˜æ•ˆå¼€å‘ã€‚
        </p>
        <p>
          <b>å½“å‰ç‰ˆæœ¬:</b> <span>v{{ version }}</span>
        </p>
      </el-col>

      <el-col :sm="24" :lg="12">
        <el-row>
          <el-col :span="12">
            <h2>æŠ€æœ¯é€‰å‹</h2>
          </el-col>
        </el-row>
        <el-row>
          <el-col :span="12">
            <h4>åç«¯æŠ€æœ¯</h4>
            <ul>
              <li>Spring Boot 3.x</li>
              <li>MyBatis</li>
              <li>Redis</li>
              <li>MySQL 8.0+</li>
            </ul>
          </el-col>
          <el-col :span="12">
            <h4>å®¢æˆ·ç«¯æŠ€æœ¯</h4>
            <ul>
              <li>Vue 3</li>
              <li>Element Plus</li>
              <li>Vite</li>
              <li>uni-app</li>
              <li>pnpm</li>
            </ul>
          </el-col>
        </el-row>
      </el-col>
    </el-row>
    <el-divider style="margin: 16px 0;" />
    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <el-row :gutter="16" class="stats-row">
      <el-col :xs="12" :sm="6" :md="6" :lg="6">
        <el-card class="stat-card stat-card-primary" shadow="hover">
          <div class="stat-content-compact">
            <div class="stat-icon-compact">
              <img src="/tech/user.svg" alt="æ€»ç”¨æˆ·æ•°" class="stat-icon-img" />
            </div>
            <div class="stat-info-compact">
              <div class="stat-label-compact">æ€»ç”¨æˆ·æ•°</div>
              <div class="stat-value-compact">{{ stats.totalUsers }}</div>
            </div>
            <div class="stat-trend-compact up">
              <el-icon :size="12" style="margin-right: 3px;"><ArrowUp /></el-icon> 12.5%
            </div>
          </div>
        </el-card>
      </el-col>
      <el-col :xs="12" :sm="6" :md="6" :lg="6">
        <el-card class="stat-card stat-card-success" shadow="hover">
          <div class="stat-content-compact">
            <div class="stat-icon-compact">
              <img src="/tech/user-online.svg" alt="åœ¨çº¿ç”¨æˆ·" class="stat-icon-img" />
            </div>
            <div class="stat-info-compact">
              <div class="stat-label-compact">åœ¨çº¿ç”¨æˆ·</div>
              <div class="stat-value-compact">{{ stats.onlineUsers }}</div>
            </div>
            <div class="stat-trend-compact up">
              <el-icon :size="12" style="margin-right: 3px;"><ArrowUp /></el-icon> 8.2%
            </div>
          </div>
        </el-card>
      </el-col>
      <el-col :xs="12" :sm="6" :md="6" :lg="6">
        <el-card class="stat-card stat-card-warning" shadow="hover">
          <div class="stat-content-compact">
            <div class="stat-icon-compact">
              <img src="/tech/view.svg" alt="ä»Šæ—¥è®¿é—®" class="stat-icon-img" />
            </div>
            <div class="stat-info-compact">
              <div class="stat-label-compact">ä»Šæ—¥è®¿é—®</div>
              <div class="stat-value-compact">{{ stats.todayVisits }}</div>
            </div>
            <div class="stat-trend-compact up">
              <el-icon :size="12" style="margin-right: 3px;"><ArrowUp /></el-icon> 15.3%
            </div>
          </div>
        </el-card>
      </el-col>
      <el-col :xs="12" :sm="6" :md="6" :lg="6">
        <el-card class="stat-card stat-card-danger" shadow="hover">
          <div class="stat-content-compact">
            <div class="stat-icon-compact">
              <img src="/tech/bell.svg" alt="ç³»ç»Ÿæ¶ˆæ¯" class="stat-icon-img" />
            </div>
            <div class="stat-info-compact">
              <div class="stat-label-compact">ç³»ç»Ÿæ¶ˆæ¯</div>
              <div class="stat-value-compact">{{ stats.systemMessages }}</div>
            </div>
            <div class="stat-trend-compact down">
              <el-icon :size="12" style="margin-right: 3px;"><ArrowDown /></el-icon> 5.1%
            </div>
          </div>
        </el-card>
      </el-col>
    </el-row>
    <el-divider style="margin: 16px 0;" />
    <!-- è¶‹åŠ¿å›¾è¡¨ -->
    <el-row :gutter="16" class="chart-row">
      <el-col :xs="24" :sm="24" :md="8" :lg="8">
        <el-card class="chart-card" shadow="hover">
          <template v-slot:header>
            <div class="chart-header">
              <span class="chart-title">ç”¨æˆ·å¢é•¿è¶‹åŠ¿</span>
              <span class="chart-subtitle">æœ€è¿‘6ä¸ªæœˆ</span>
            </div>
          </template>
          <div ref="userChart" class="chart-container"></div>
        </el-card>
      </el-col>
      <el-col :xs="24" :sm="24" :md="8" :lg="8">
        <el-card class="chart-card" shadow="hover">
          <template v-slot:header>
            <div class="chart-header">
              <span class="chart-title">æ“ä½œç±»å‹åˆ†å¸ƒ</span>
              <span class="chart-subtitle">å®æ—¶ç»Ÿè®¡</span>
            </div>
          </template>
          <div ref="operationChart" class="chart-container"></div>
        </el-card>
      </el-col>
      <el-col :xs="24" :sm="24" :md="8" :lg="8">
        <el-card class="chart-card" shadow="hover">
          <template v-slot:header>
            <div class="chart-header">
              <span class="chart-title">ç³»ç»Ÿæ€§èƒ½ç›‘æ§</span>
              <span class="chart-subtitle">24å°æ—¶</span>
            </div>
          </template>
          <div ref="performanceChart" class="chart-container"></div>
        </el-card>
      </el-col>
    </el-row>
    <el-divider style="margin: 16px 0;" />
    <el-row :gutter="16">
      <el-col :xs="24" :sm="24" :md="12" :lg="8">
        <el-card class="ai-test-card" shadow="hover">
          <template v-slot:header>
            <div class="card-header">
              <span class="card-title">ğŸ¤– AI èŠå¤©æµ‹è¯•</span>
            </div>
          </template>
          <div class="body">
            <p>æµ‹è¯• Spring AI é›†æˆçš„ DeepSeek èŠå¤©åŠŸèƒ½</p>
            <el-button type="primary" @click="openAiChatDialog" style="width: 100%; margin-top: 12px;">
              <el-icon style="margin-right: 5px;"><ChatDotRound /></el-icon>
              å¼€å§‹èŠå¤©
            </el-button>
          </div>
        </el-card>
      </el-col>
      <el-col :xs="24" :sm="24" :md="12" :lg="8">
        <el-card>
          <template v-slot:header>
            <div class="card-header">
              <span class="card-title">æ ¸å¿ƒç‰¹æ€§</span>
            </div>
          </template>
          <div class="body">
            <ul>
              <li>âœ… ä¼ä¸šçº§åŠŸèƒ½æ¨¡å—ï¼ˆç”¨æˆ·æƒé™ã€ç³»ç»Ÿç›‘æ§ã€å®šæ—¶ä»»åŠ¡ç­‰ï¼‰</li>
              <li>âœ… AI è¾…åŠ©å¼€å‘åŸºç¡€ï¼Œè§„èŒƒåŒ–é¡¹ç›®ç»“æ„</li>
              <li>âœ… å‰åç«¯ç»Ÿä¸€ä»“åº“ï¼Œä¾¿äº AI ç†è§£ä¸šåŠ¡ä¸Šä¸‹æ–‡</li>
              <li>âœ… æ”¯æŒ Web å’Œç§»åŠ¨ç«¯å¤šç«¯å¼€å‘</li>
              <li>âœ… å®Œå–„çš„å¼€å‘è§„èŒƒæ–‡æ¡£</li>
              <li>âœ… é¢„é…ç½®è°ƒè¯•å¯åŠ¨é¡¹ï¼Œæ”¯æŒæ–­ç‚¹è°ƒè¯•</li>
            </ul>
          </div>
        </el-card>
      </el-col>
      <el-col :xs="24" :sm="24" :md="12" :lg="8">
        <el-card>
          <template v-slot:header>
            <div class="card-header">
              <span class="card-title">å¿«é€Ÿå¼€å§‹</span>
            </div>
          </template>
          <div class="body">
            <ol>
              <li>ç¯å¢ƒå‡†å¤‡ï¼šJDK 17+ã€Maven 3.6+ã€Node.js 20.19+ æˆ– 22.12+ã€pnpm 8+ã€MySQL 8.0+ã€Redis 6.0+</li>
              <li>åˆå§‹åŒ–æ•°æ®åº“ï¼šæ‰§è¡Œ <code>sql/ry_20250522.sql</code></li>
              <li>å¯åŠ¨æœåŠ¡ï¼šåœ¨ Cursor ä¸­æŒ‰ <kbd>F5</kbd>ï¼Œé€‰æ‹© "RuoYi Backend" æˆ– "RuoYi Frontend"</li>
              <li>è®¿é—®ç³»ç»Ÿï¼šå‰ç«¯ <a href="http://localhost" target="_blank">http://localhost</a>ï¼ŒAPI æ–‡æ¡£ <a href="http://localhost:8080/swagger-ui.html" target="_blank">http://localhost:8080/swagger-ui.html</a></li>
            </ol>
          </div>
        </el-card>
      </el-col>
      <el-col :xs="24" :sm="24" :md="12" :lg="8">
        <el-card>
          <template v-slot:header>
            <div class="card-header">
              <span class="card-title">å¼€å‘æŒ‡å—</span>
            </div>
          </template>
          <div class="body">
            <p>
              æœ¬é¡¹ç›®å·²é’ˆå¯¹ <strong>Cursor AI</strong> è¿›è¡Œä¼˜åŒ–é…ç½®ï¼Œæ¨èä½¿ç”¨ Cursor ç¼–è¾‘å™¨è¿›è¡Œå¼€å‘ã€‚
            </p>
            <p>
              <strong>ä½¿ç”¨ Cursor AI å¼€å‘å·¥ä½œæµï¼š</strong>
            </p>
            <ul>
              <li>ä»£ç ç”Ÿæˆï¼šä½¿ç”¨ @ ç¬¦å·å¼•ç”¨æ–‡ä»¶æˆ–ä»£ç </li>
              <li>ä»£ç é‡æ„ï¼šé€‰ä¸­ä»£ç åï¼Œä½¿ç”¨ Cmd/Ctrl + K è¿›è¡Œ AI é‡æ„</li>
              <li>é—®é¢˜ä¿®å¤ï¼šé€‰ä¸­é”™è¯¯ä»£ç ï¼Œä½¿ç”¨ AI è‡ªåŠ¨ä¿®å¤</li>
              <li>åŠŸèƒ½å¼€å‘ï¼šæè¿°éœ€æ±‚ï¼ŒAI è‡ªåŠ¨ç”Ÿæˆä»£ç </li>
            </ul>
            <p>
              æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹é¡¹ç›® <a href="README.md" target="_blank">README.md</a> æ–‡æ¡£ã€‚
            </p>
          </div>
        </el-card>
      </el-col>
    </el-row>
    
    <!-- AI èŠå¤©å¯¹è¯æ¡† -->
    <el-dialog
      v-model="aiChatDialogVisible"
      title="ğŸ¤– AI èŠå¤©æµ‹è¯•"
      width="600px"
      :close-on-click-modal="false"
    >
      <div class="ai-chat-container">
        <el-input
          v-model="aiChatMessage"
          type="textarea"
          :rows="3"
          placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..."
          @keydown.ctrl.enter="sendAiMessage"
        />
        <div style="margin-top: 12px; text-align: right;">
          <el-button @click="aiChatDialogVisible = false">å–æ¶ˆ</el-button>
          <el-button type="primary" @click="sendAiMessage" :loading="aiChatLoading">
            å‘é€
          </el-button>
        </div>
        <div class="ai-response" style="margin-top: 20px; padding: 12px; background: #f5f7fa; border-radius: 4px; min-height: 100px;">
          <div style="font-weight: 600; margin-bottom: 8px; color: #409eff;">AI å›å¤ï¼š</div>
          <div style="line-height: 1.6;">
            <MarkdownRender 
              custom-id="ai-chat-response"
              :content="aiChatContent" 
            />
          </div>
        </div>
      </div>
    </el-dialog>
  </div>
</template>

<script setup name="Index">
import * as echarts from 'echarts'
import { ref, computed } from 'vue'
import { ElMessage } from 'element-plus'
import { ChatDotRound, Loading } from '@element-plus/icons-vue'
import useSettingsStore from '@/store/modules/settings'
import { streamChat } from '@/api/ai/chat'

const version = ref('1.0.0')
const settingsStore = useSettingsStore()

// AI èŠå¤©å¯¹è¯æ¡†
const aiChatDialogVisible = ref(false)
const aiChatMessage = ref('')
const aiChatContent = ref('')
const aiChatLoading = ref(false)
let abortStream = null

// æ‰“å¼€ AI èŠå¤©å¯¹è¯æ¡†
function openAiChatDialog() {
  aiChatDialogVisible.value = true
  aiChatMessage.value = ''
  aiChatContent.value = ''
  aiChatLoading.value = false
  // å–æ¶ˆä¹‹å‰çš„è¯·æ±‚
  if (abortStream) {
    abortStream()
    abortStream = null
  }
}

// å‘é€ AI èŠå¤©æ¶ˆæ¯
function sendAiMessage() {
  const message = aiChatMessage.value.trim()
  if (!message) {
    ElMessage.warning('è¯·è¾“å…¥æ¶ˆæ¯å†…å®¹')
    return
  }
  
  // é˜²æ­¢é‡å¤æäº¤
  if (aiChatLoading.value) {
    return
  }
  
  // å–æ¶ˆä¹‹å‰çš„è¯·æ±‚
  if (abortStream) {
    abortStream()
  }
  
  aiChatLoading.value = true
  aiChatContent.value = ''
  
  abortStream = streamChat(
    { message },
    (text) => {
      aiChatContent.value += text || ''
    },
    (error) => {
      const errorMsg = error.message?.includes('timeout') 
        ? 'è¯·æ±‚è¶…æ—¶ï¼ŒAI å“åº”æ—¶é—´è¿‡é•¿ï¼Œè¯·ç¨åé‡è¯•'
        : error.message || 'AI èŠå¤©å¤±è´¥'
      ElMessage.error(errorMsg)
      aiChatLoading.value = false
      abortStream = null
    },
    () => {
      aiChatLoading.value = false
      abortStream = null
    }
  )
}

// æ£€æµ‹æ˜¯å¦ä¸ºæš—è‰²æ¨¡å¼ï¼ˆå“åº”å¼ï¼‰
const isDark = computed(() => {
  return settingsStore.isDark || document.documentElement.classList.contains('dark')
})

// è·å–å›¾è¡¨æ–‡å­—é¢œè‰²ï¼ˆæ ¹æ®æš—è‰²æ¨¡å¼ï¼‰
const getChartTextColor = () => {
  return isDark.value ? 'rgba(255, 255, 255, 0.8)' : '#909399'
}

// è·å–å›¾è¡¨è½´çº¿é¢œè‰²ï¼ˆæ ¹æ®æš—è‰²æ¨¡å¼ï¼‰
const getChartAxisLineColor = () => {
  return isDark.value ? 'rgba(255, 255, 255, 0.2)' : '#e4e7ed'
}

// è·å–å›¾è¡¨åˆ†å‰²çº¿é¢œè‰²ï¼ˆæ ¹æ®æš—è‰²æ¨¡å¼ï¼‰
const getChartSplitLineColor = () => {
  return isDark.value ? 'rgba(255, 255, 255, 0.1)' : '#f0f2f5'
}

// è·å–å›¾è¡¨ tooltip èƒŒæ™¯è‰²ï¼ˆæ ¹æ®æš—è‰²æ¨¡å¼ï¼‰
const getChartTooltipBg = () => {
  return isDark.value ? 'rgba(29, 30, 31, 0.95)' : 'rgba(255, 255, 255, 0.95)'
}

// è·å–å›¾è¡¨ tooltip æ–‡å­—é¢œè‰²ï¼ˆæ ¹æ®æš—è‰²æ¨¡å¼ï¼‰
const getChartTooltipTextColor = () => {
  return isDark.value ? 'rgba(255, 255, 255, 0.9)' : '#303133'
}

// è·å–å›¾è¡¨ tooltip è¾¹æ¡†é¢œè‰²ï¼ˆæ ¹æ®æš—è‰²æ¨¡å¼ï¼‰
const getChartTooltipBorderColor = () => {
  return isDark.value ? 'rgba(255, 255, 255, 0.2)' : '#e4e7ed'
}

// ç»Ÿè®¡æ•°æ®
const stats = ref({
  totalUsers: 1234,
  onlineUsers: 56,
  todayVisits: 892,
  systemMessages: 23
})

// å›¾è¡¨å¼•ç”¨
const userChart = ref(null)
const operationChart = ref(null)
const performanceChart = ref(null)

// å›¾è¡¨å®ä¾‹
let userChartInstance = null
let operationChartInstance = null
let performanceChartInstance = null

function goTarget(url) {
  window.open(url, '__blank')
}

// åˆå§‹åŒ–ç”¨æˆ·å¢é•¿è¶‹åŠ¿å›¾
function initUserChart() {
  if (!userChart.value) return
  
  userChartInstance = echarts.init(userChart.value)
  const option = {
    tooltip: {
      trigger: 'axis',
      backgroundColor: getChartTooltipBg(),
      borderColor: getChartTooltipBorderColor(),
      borderWidth: 1,
      textStyle: {
        color: getChartTooltipTextColor()
      }
    },
    grid: {
      left: '3%',
      right: '4%',
      bottom: '3%',
      top: '10%',
      containLabel: true
    },
    xAxis: {
      type: 'category',
      data: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'],
      axisLine: {
        lineStyle: {
          color: getChartAxisLineColor()
        }
      },
      axisLabel: {
        color: getChartTextColor()
      }
    },
    yAxis: {
      type: 'value',
      axisLine: {
        lineStyle: {
          color: getChartAxisLineColor()
        }
      },
      axisLabel: {
        color: getChartTextColor()
      },
      splitLine: {
        lineStyle: {
          color: getChartSplitLineColor(),
          type: 'dashed'
        }
      }
    },
    series: [
      {
        name: 'æ–°å¢ç”¨æˆ·',
        type: 'bar',
        barWidth: '50%',
        data: [120, 132, 101, 134, 90, 230],
        itemStyle: {
          borderRadius: [4, 4, 0, 0],
          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
            { offset: 0, color: '#67C23A' },
            { offset: 1, color: '#85ce61' }
          ])
        },
        emphasis: {
          itemStyle: {
            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
              { offset: 0, color: '#85ce61' },
              { offset: 1, color: '#67C23A' }
            ])
          }
        }
      }
    ]
  }
  userChartInstance.setOption(option)
}

// åˆå§‹åŒ–æ“ä½œç±»å‹åˆ†å¸ƒå›¾
function initOperationChart() {
  if (!operationChart.value) return
  
  operationChartInstance = echarts.init(operationChart.value)
  const option = {
    tooltip: {
      trigger: 'item',
      formatter: '{a} <br/>{b}: {c} ({d}%)',
      backgroundColor: getChartTooltipBg(),
      borderColor: getChartTooltipBorderColor(),
      borderWidth: 1,
      textStyle: {
        color: getChartTooltipTextColor()
      }
    },
    legend: {
      orient: 'vertical',
      left: 'left',
      top: 'middle',
      textStyle: {
        color: getChartTextColor(),
        fontSize: 12
      }
    },
    series: [
      {
        name: 'æ“ä½œç±»å‹',
        type: 'pie',
        radius: ['40%', '70%'],
        center: ['60%', '50%'],
        avoidLabelOverlap: false,
        itemStyle: {
          borderRadius: 10,
          borderColor: isDark.value ? 'rgba(20, 20, 20, 0.8)' : '#fff',
          borderWidth: 2
        },
        label: {
          show: false,
          position: 'center'
        },
        emphasis: {
          label: {
            show: true,
            fontSize: '20',
            fontWeight: 'bold',
            color: getChartTooltipTextColor()
          },
          itemStyle: {
            shadowBlur: 10,
            shadowOffsetX: 0,
            shadowColor: 'rgba(0, 0, 0, 0.5)'
          }
        },
        labelLine: {
          show: false
        },
        data: [
          { value: 335, name: 'æŸ¥è¯¢æ“ä½œ', itemStyle: { color: '#409EFF' } },
          { value: 310, name: 'æ–°å¢æ“ä½œ', itemStyle: { color: '#67C23A' } },
          { value: 234, name: 'ä¿®æ”¹æ“ä½œ', itemStyle: { color: '#E6A23C' } },
          { value: 135, name: 'åˆ é™¤æ“ä½œ', itemStyle: { color: '#F56C6C' } },
          { value: 154, name: 'å…¶ä»–æ“ä½œ', itemStyle: { color: '#909399' } }
        ]
      }
    ]
  }
  operationChartInstance.setOption(option)
}

// åˆå§‹åŒ–ç³»ç»Ÿæ€§èƒ½ç›‘æ§å›¾
function initPerformanceChart() {
  if (!performanceChart.value) return
  
  performanceChartInstance = echarts.init(performanceChart.value)
  const option = {
    tooltip: {
      trigger: 'axis',
      backgroundColor: getChartTooltipBg(),
      borderColor: getChartTooltipBorderColor(),
      borderWidth: 1,
      textStyle: {
        color: getChartTooltipTextColor()
      }
    },
    legend: {
      data: ['CPUä½¿ç”¨ç‡', 'å†…å­˜ä½¿ç”¨ç‡'],
      top: 10,
      textStyle: {
        color: getChartTextColor()
      }
    },
    grid: {
      left: '3%',
      right: '4%',
      bottom: '3%',
      top: '15%',
      containLabel: true
    },
    xAxis: {
      type: 'category',
      boundaryGap: false,
      data: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '24:00'],
      axisLine: {
        lineStyle: {
          color: getChartAxisLineColor()
        }
      },
      axisLabel: {
        color: getChartTextColor()
      }
    },
    yAxis: {
      type: 'value',
      max: 100,
      axisLine: {
        lineStyle: {
          color: getChartAxisLineColor()
        }
      },
      axisLabel: {
        color: getChartTextColor(),
        formatter: '{value}%'
      },
      splitLine: {
        lineStyle: {
          color: getChartSplitLineColor(),
          type: 'dashed'
        }
      }
    },
    series: [
      {
        name: 'CPUä½¿ç”¨ç‡',
        type: 'line',
        smooth: true,
        symbol: 'circle',
        symbolSize: 6,
        data: [45, 52, 38, 65, 58, 42, 48],
        itemStyle: {
          color: '#409EFF',
          borderColor: isDark.value ? 'rgba(20, 20, 20, 0.8)' : '#fff',
          borderWidth: 2
        },
        lineStyle: {
          width: 3,
          color: '#409EFF'
        },
        areaStyle: {
          color: {
            type: 'linear',
            x: 0,
            y: 0,
            x2: 0,
            y2: 1,
            colorStops: [
              { offset: 0, color: 'rgba(64, 158, 255, 0.3)' },
              { offset: 1, color: 'rgba(64, 158, 255, 0.05)' }
            ]
          }
        }
      },
      {
        name: 'å†…å­˜ä½¿ç”¨ç‡',
        type: 'line',
        smooth: true,
        symbol: 'circle',
        symbolSize: 6,
        data: [62, 58, 65, 72, 68, 60, 64],
        itemStyle: {
          color: '#67C23A',
          borderColor: isDark.value ? 'rgba(20, 20, 20, 0.8)' : '#fff',
          borderWidth: 2
        },
        lineStyle: {
          width: 3,
          color: '#67C23A'
        },
        areaStyle: {
          color: {
            type: 'linear',
            x: 0,
            y: 0,
            x2: 0,
            y2: 1,
            colorStops: [
              { offset: 0, color: 'rgba(103, 194, 58, 0.3)' },
              { offset: 1, color: 'rgba(103, 194, 58, 0.05)' }
            ]
          }
        }
      }
    ]
  }
  performanceChartInstance.setOption(option)
}


// çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è°ƒæ•´å›¾è¡¨
function handleResize() {
  userChartInstance?.resize()
  operationChartInstance?.resize()
  performanceChartInstance?.resize()
}

// ç›‘å¬æš—è‰²æ¨¡å¼å˜åŒ–ï¼Œé‡æ–°æ¸²æŸ“å›¾è¡¨
watch(() => settingsStore.isDark, () => {
  nextTick(() => {
    if (userChartInstance) {
      initUserChart()
    }
    if (operationChartInstance) {
      initOperationChart()
    }
    if (performanceChartInstance) {
      initPerformanceChart()
    }
  })
})

// ç›‘å¬ DOM çš„ dark ç±»å˜åŒ–
const observer = new MutationObserver(() => {
  nextTick(() => {
    if (userChartInstance) {
      initUserChart()
    }
    if (operationChartInstance) {
      initOperationChart()
    }
    if (performanceChartInstance) {
      initPerformanceChart()
    }
  })
})

onMounted(() => {
  // ä½¿ç”¨åŒé‡ nextTick å’Œ setTimeout ç¡®ä¿ DOM å®Œå…¨æ¸²æŸ“
  nextTick(() => {
    setTimeout(() => {
      initUserChart()
      initOperationChart()
      initPerformanceChart()
      
      window.addEventListener('resize', handleResize)
      
      // ç›‘å¬ html å…ƒç´ çš„ class å˜åŒ–ï¼ˆæš—è‰²æ¨¡å¼åˆ‡æ¢ï¼‰
      observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class']
      })
    }, 100)
  })
})

onUnmounted(() => {
  window.removeEventListener('resize', handleResize)
  observer.disconnect()
  userChartInstance?.dispose()
  operationChartInstance?.dispose()
  performanceChartInstance?.dispose()
})
</script>

<style scoped lang="scss">
.home {
  blockquote {
    padding: 10px 20px;
    margin: 0 0 20px;
    font-size: 17.5px;
    border-left: 5px solid #eee;
  }
  hr {
    margin-top: 20px;
    margin-bottom: 20px;
    border: 0;
    border-top: 1px solid #eee;
  }
  .col-item {
    margin-bottom: 20px;
  }

  ul {
    padding: 0;
    margin: 0;
  }

  font-family: inherit;
  font-size: 13px;
  color: #676a6c;
  overflow-x: hidden;
  
  // æš—è‰²æ¨¡å¼ä¸‹çš„æ–‡å­—é¢œè‰²ä¼šåœ¨ variables.module.scss ä¸­è¦†ç›–

  .intro-row {
    margin-bottom: 12px;
  }

  ul {
    list-style-type: disc;
    padding-left: 18px;
    margin: 6px 0;
    
    li {
      margin: 3px 0;
      line-height: 1.5;
      font-size: 13px;
    }
  }

  ol {
    list-style-type: decimal;
    padding-left: 18px;
    margin: 6px 0;
    
    li {
      margin: 3px 0;
      line-height: 1.5;
      font-size: 13px;
    }
  }

  h4 {
    margin-top: 0px;
    margin-bottom: 8px;
    font-size: 15px;
    font-weight: 600;
  }

  h2 {
    margin-top: 0px;
    margin-bottom: 12px;
    font-size: 24px;
    font-weight: 100;
  }

  p {
    margin-top: 8px;
    margin-bottom: 8px;
    line-height: 1.6;

    b {
      font-weight: 700;
    }

    strong {
      font-weight: 600;
    }

    code {
      background-color: #f4f4f5;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }

    kbd {
      background-color: #f4f4f5;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      border: 1px solid #d3d3d3;
    }

    a {
      color: #409eff;
      text-decoration: none;
      
      &:hover {
        text-decoration: underline;
      }
    }
  }

  .el-card {
    .body {
      ul, ol {
        margin: 10px 0;
      }
    }
  }

  .stats-row {
    margin-bottom: 16px;
  }

  .stat-card {
    cursor: pointer;
    transition: all 0.25s ease;
    position: relative;
    border: 1px solid #f0f2f5;
    border-radius: 8px;
    background: #ffffff;
    overflow: hidden;
    
    :deep(.el-card__body) {
      padding: 16px;
    }

    &::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 3px;
      height: 100%;
      background: currentColor;
      opacity: 0;
      transition: opacity 0.25s ease;
    }

    &:hover {
      border-color: currentColor;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transform: translateY(-2px);

      &::before {
        opacity: 1;
      }

      .stat-icon-compact {
        transform: scale(1.1);
      }
    }

    .stat-content-compact {
      display: flex;
      align-items: center;
      gap: 14px;

      .stat-icon-compact {
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.25s ease;

        .stat-icon-img {
          width: 32px;
          height: 32px;
          object-fit: contain;
        }
      }

      .stat-info-compact {
        flex: 1;
        min-width: 0;

        .stat-label-compact {
          font-size: 12px;
          color: #909399;
          margin-bottom: 6px;
          font-weight: 400;
          letter-spacing: 0.3px;
        }

        .stat-value-compact {
          font-size: 24px;
          font-weight: 600;
          line-height: 1.2;
          color: #303133;
          white-space: nowrap;
        }
      }

      .stat-trend-compact {
        flex-shrink: 0;
        display: flex;
        align-items: center;
        font-size: 12px;
        font-weight: 500;
        padding: 4px 8px;
        border-radius: 12px;
        white-space: nowrap;
        transition: all 0.25s ease;

        &.up {
          color: #52c41a;
          background: #f6ffed;
          border: 1px solid #b7eb8f;
        }

        &.down {
          color: #ff4d4f;
          background: #fff1f0;
          border: 1px solid #ffccc7;
        }
      }
    }

    &.stat-card-primary {
      color: #1890ff;

      &:hover {
        border-color: #1890ff;
      }
    }

    &.stat-card-success {
      color: #52c41a;

      &:hover {
        border-color: #52c41a;
      }
    }

    &.stat-card-warning {
      color: #faad14;

      &:hover {
        border-color: #faad14;
      }
    }

    &.stat-card-danger {
      color: #ff4d4f;

      &:hover {
        border-color: #ff4d4f;
      }
    }
  }

  .chart-row {
    margin-bottom: 16px;
  }

  .chart-card {
    border-radius: 8px;
    transition: all 0.3s;
    
    :deep(.el-card__body) {
      padding: 16px;
    }
    
    :deep(.el-card__header) {
      padding: 12px 16px;
      border-bottom: 1px solid #f0f0f0;
    }

    &:hover {
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;

      .chart-title {
        font-size: 15px;
        font-weight: 600;
        color: #303133;
        line-height: 1.5;
        font-family: inherit;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .chart-subtitle {
        font-size: 11px;
        color: #909399;
      }
    }

    .chart-container {
      width: 100%;
      height: 240px;
      min-height: 240px;
    }
  }
  
  .el-card {
    :deep(.el-card__header) {
      padding: 12px 16px;
      border-bottom: 1px solid #f0f0f0;
    }
    
    :deep(.el-card__body) {
      padding: 16px;
    }
    
    // ç»Ÿä¸€æ‰€æœ‰å¡ç‰‡æ ‡é¢˜æ ·å¼ï¼ˆåŒ…æ‹¬å›¾è¡¨å¡ç‰‡å’Œæ™®é€šå¡ç‰‡ï¼‰
    .chart-header,
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .chart-title,
    .card-title {
      font-size: 15px !important;
      font-weight: 600 !important;
      color: #303133;
      line-height: 1.5 !important;
      font-family: inherit !important;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      margin: 0;
      padding: 0;
    }
    
    .body {
      ul, ol {
        margin: 8px 0;
      }
    }
  }
  
  .ai-test-card {
    border: 2px solid #409eff;
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    
    &:hover {
      border-color: #66b1ff;
      box-shadow: 0 6px 20px rgba(64, 158, 255, 0.2);
    }
    
    .card-title {
      color: #409eff;
      font-weight: 700;
    }
  }
  
  .ai-chat-container {
    .ai-response {
      max-height: 300px;
      overflow-y: auto;
    }
  }
}

// æš—è‰²æ¨¡å¼ä¸‹çš„æ–‡å­—é¢œè‰²è¦†ç›– - ä½¿ç”¨å…¨å±€é€‰æ‹©å™¨ç¡®ä¿ä¼˜å…ˆçº§
html.dark {
  .home {
    color: #ffffff !important;
    
    h2, h4, p, span, li {
      color: #ffffff !important;
    }
    
    .chart-title,
    .card-title {
      color: #ffffff !important;
    }
    
    .chart-subtitle {
      color: rgba(255, 255, 255, 0.8) !important;
    }
    
    .stat-label-compact {
      color: rgba(255, 255, 255, 0.8) !important;
    }
    
    .stat-value-compact {
      color: #ffffff !important;
    }
    
    .el-card {
      :deep(.el-card__body) {
        color: #ffffff !important;
      }
      
      .body {
        color: #ffffff !important;
        
        p, li, code, kbd {
          color: #ffffff !important;
        }
      }
    }
  }
}
</style>
