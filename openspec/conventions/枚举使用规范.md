# 枚举使用规范

## 1. 概述

枚举（Enum）是 Java 中用于定义一组固定常量的类型。在项目中，枚举用于表示业务状态、操作类型、数据字典等固定值集合。

## 2. 枚举定义规范

### 2.1 命名规范

- **枚举类名**：使用大驼峰命名（PascalCase），以业务含义命名
  - ✅ 正确：`UserStatus`、`BusinessType`、`OperatorType`
  - ❌ 错误：`userStatus`、`business_type`、`User_Status`

- **枚举值名**：使用大写下划线分隔（UPPER_SNAKE_CASE）
  - ✅ 正确：`OK`、`DISABLE`、`INSERT`、`UPDATE`
  - ❌ 错误：`ok`、`disable`、`Insert`、`update`

### 2.2 枚举类型

#### 2.2.1 简单枚举

适用于不需要额外信息的枚举，如操作类型：

```java
package com.ruoyi.common.enums;

/**
 * 业务操作类型
 * 
 * @author evan
 */
public enum BusinessType
{
    /**
     * 其它
     */
    OTHER,

    /**
     * 新增
     */
    INSERT,

    /**
     * 修改
     */
    UPDATE,

    /**
     * 删除
     */
    DELETE,

    /**
     * 授权
     */
    GRANT,

    /**
     * 导出
     */
    EXPORT,

    /**
     * 导入
     */
    IMPORT,

    /**
     * 强退
     */
    FORCE,

    /**
     * 生成代码
     */
    GENCODE,
    
    /**
     * 清空数据
     */
    CLEAN,
}
```

#### 2.2.2 带值的枚举

适用于需要关联代码值或描述信息的枚举，如状态枚举：

```java
package com.ruoyi.common.enums;

/**
 * 用户状态
 * 
 * @author evan
 */
public enum UserStatus
{
    OK("0", "正常"), 
    DISABLE("1", "停用"), 
    DELETED("2", "删除");

    private final String code;
    private final String info;

    UserStatus(String code, String info)
    {
        this.code = code;
        this.info = info;
    }

    public String getCode()
    {
        return code;
    }

    public String getInfo()
    {
        return info;
    }
    
    /**
     * 根据代码获取枚举
     */
    public static UserStatus getByCode(String code)
    {
        for (UserStatus status : values())
        {
            if (status.getCode().equals(code))
            {
                return status;
            }
        }
        return null;
    }
}
```

### 2.3 枚举位置

- **包路径**：`com.ruoyi.common.enums`
- **文件位置**：`ruoyi-common/src/main/java/com/ruoyi/common/enums/`

## 3. 枚举使用规范

### 3.1 在实体类中使用

```java
public class SysUser extends BaseEntity
{
    // 使用枚举类型
    private UserStatus status;
    
    // 或使用字符串存储枚举代码值
    private String status; // 存储 "0"、"1"、"2"
    
    // 提供枚举转换方法
    public UserStatus getStatusEnum()
    {
        return UserStatus.getByCode(this.status);
    }
}
```

### 3.2 在 Service 中使用

```java
@Service
public class UserServiceImpl implements IUserService
{
    public void updateUserStatus(Long userId, UserStatus status)
    {
        SysUser user = userMapper.selectUserById(userId);
        user.setStatus(status.getCode());
        userMapper.updateUser(user);
    }
    
    public List<SysUser> selectUsersByStatus(UserStatus status)
    {
        SysUser query = new SysUser();
        query.setStatus(status.getCode());
        return userMapper.selectUserList(query);
    }
}
```

### 3.3 在 Controller 中使用

```java
@RestController
@RequestMapping("/system/user")
public class SysUserController
{
    @PostMapping("/changeStatus")
    public AjaxResult changeStatus(@RequestParam Long userId, 
                                   @RequestParam String status)
    {
        UserStatus userStatus = UserStatus.getByCode(status);
        if (userStatus == null)
        {
            return AjaxResult.error("无效的状态值");
        }
        
        userService.updateUserStatus(userId, userStatus);
        return AjaxResult.success();
    }
}
```

### 3.4 在条件判断中使用

```java
// ✅ 推荐：使用枚举比较
if (user.getStatusEnum() == UserStatus.OK)
{
    // 处理正常状态
}

// ✅ 推荐：使用 switch 语句
switch (businessType)
{
    case INSERT:
        // 处理新增
        break;
    case UPDATE:
        // 处理修改
        break;
    default:
        // 处理其他
        break;
}

// ❌ 不推荐：使用字符串比较
if ("0".equals(user.getStatus()))
{
    // 容易出错，不推荐
}
```

## 4. 枚举与字典管理

### 4.1 字典管理模块概述

字典管理是系统中用于管理可配置选项的模块，通过 `sys_dict_type`（字典类型表）和 `sys_dict_data`（字典数据表）实现。

**核心组件：**
- `SysDictType` - 字典类型实体
- `SysDictData` - 字典数据实体
- `ISysDictTypeService` - 字典类型服务
- `ISysDictDataService` - 字典数据服务
- `DictUtils` - 字典工具类

### 4.2 枚举与字典的关系

| 特性 | 枚举（Enum） | 字典（Dict） |
|------|------------|------------|
| **定义位置** | 代码中定义 | 数据库中存储 |
| **确定时机** | 编译时确定 | 运行时确定 |
| **修改方式** | 修改代码重新编译 | 通过管理界面修改 |
| **适用场景** | 固定业务逻辑 | 可配置业务选项 |
| **性能** | 编译时优化 | 需要数据库查询（有缓存） |
| **类型安全** | 强类型，编译检查 | 字符串类型，运行时检查 |

### 4.3 使用场景选择

#### 4.3.1 使用枚举的场景

✅ **推荐使用枚举：**

1. **业务逻辑中的固定状态**
   ```java
   // 用户状态：正常、停用、删除（业务逻辑固定）
   public enum UserStatus {
       OK("0", "正常"),
       DISABLE("1", "停用"),
       DELETED("2", "删除");
   }
   ```

2. **操作类型**
   ```java
   // 业务操作类型：新增、修改、删除等（代码逻辑固定）
   public enum BusinessType {
       INSERT, UPDATE, DELETE, EXPORT, IMPORT;
   }
   ```

3. **系统级常量**
   ```java
   // HTTP 方法、数据源类型等（技术层面固定）
   public enum HttpMethod {
       GET, POST, PUT, DELETE;
   }
   ```

#### 4.3.2 使用字典的场景

✅ **推荐使用字典：**

1. **前端展示选项**
   ```java
   // 用户性别：男、女、未知（可通过管理界面配置）
   // 字典类型：sys_user_sex
   ```

2. **业务配置项**
   ```java
   // 订单状态：待支付、已支付、已发货等（业务可能扩展）
   // 字典类型：order_status
   ```

3. **可扩展的分类**
   ```java
   // 商品分类、地区信息等（需要动态管理）
   // 字典类型：product_category, region_info
   ```

### 4.4 枚举与字典的转换

#### 4.4.1 枚举转字典数据

```java
import com.ruoyi.common.core.domain.entity.SysDictData;
import com.ruoyi.common.enums.UserStatus;

/**
 * 将枚举转换为字典数据格式
 */
public SysDictData enumToDictData(UserStatus status)
{
    SysDictData dict = new SysDictData();
    dict.setDictValue(status.getCode());  // 字典键值
    dict.setDictLabel(status.getInfo());   // 字典标签
    dict.setDictType("sys_user_status");  // 字典类型
    return dict;
}

/**
 * 批量转换枚举为字典数据列表
 */
public List<SysDictData> enumListToDictDataList()
{
    List<SysDictData> list = new ArrayList<>();
    for (UserStatus status : UserStatus.values())
    {
        list.add(enumToDictData(status));
    }
    return list;
}
```

#### 4.4.2 字典数据转枚举

```java
import com.ruoyi.common.utils.DictUtils;
import com.ruoyi.common.enums.UserStatus;

/**
 * 根据字典值获取枚举
 */
public UserStatus dictValueToEnum(String dictValue)
{
    // 方式1：直接通过字典值转换
    return UserStatus.getByCode(dictValue);
    
    // 方式2：通过字典类型和值获取标签，再转换
    String dictLabel = DictUtils.getDictLabel("sys_user_status", dictValue);
    // 根据标签查找枚举（需要枚举支持）
}
```

#### 4.4.3 使用字典工具类

```java
import com.ruoyi.common.utils.DictUtils;
import com.ruoyi.system.service.ISysDictTypeService;

@Service
public class UserServiceImpl implements IUserService
{
    @Autowired
    private ISysDictTypeService dictTypeService;
    
    /**
     * 获取字典标签（用于前端展示）
     */
    public String getUserStatusLabel(String statusCode)
    {
        // 通过字典工具类获取标签
        return DictUtils.getDictLabel("sys_user_status", statusCode);
    }
    
    /**
     * 获取字典数据列表（用于下拉框等）
     */
    public List<SysDictData> getUserStatusOptions()
    {
        return dictTypeService.selectDictDataByType("sys_user_status");
    }
    
    /**
     * 验证状态值是否有效
     */
    public boolean isValidStatus(String statusCode)
    {
        // 方式1：通过枚举验证
        return UserStatus.getByCode(statusCode) != null;
        
        // 方式2：通过字典验证
        String label = DictUtils.getDictLabel("sys_user_status", statusCode);
        return StringUtils.isNotEmpty(label);
    }
}
```

### 4.5 字典管理使用

#### 4.5.1 字典类型命名规范

字典类型（`dict_type`）命名规范：

- 使用小写下划线分隔：`sys_user_sex`、`order_status`
- 以模块前缀开头：`sys_`、`business_`、`app_`
- 命名清晰表达用途

#### 4.5.2 字典数据管理

**通过管理界面：**
1. 访问：系统管理 → 字典管理
2. 创建字典类型
3. 添加字典数据（键值、标签、排序等）

**通过代码使用：**

```java
@Service
public class OrderServiceImpl implements IOrderService
{
    @Autowired
    private ISysDictTypeService dictTypeService;
    
    /**
     * 获取订单状态选项
     */
    public List<SysDictData> getOrderStatusOptions()
    {
        return dictTypeService.selectDictDataByType("order_status");
    }
    
    /**
     * 获取订单状态标签
     */
    public String getOrderStatusLabel(String statusValue)
    {
        return DictUtils.getDictLabel("order_status", statusValue);
    }
}
```

#### 4.5.3 字典缓存机制

字典数据使用 Redis 缓存，提高访问性能：

```java
// 字典缓存键格式：sys_dict:{dictType}
// 例如：sys_dict:sys_user_sex

// 缓存操作
dictTypeService.loadingDictCache();    // 加载缓存
dictTypeService.clearDictCache();      // 清空缓存
dictTypeService.resetDictCache();      // 重置缓存
```

### 4.6 混合使用场景

在实际开发中，可以同时使用枚举和字典：

```java
@Service
public class UserServiceImpl implements IUserService
{
    /**
     * 业务逻辑中使用枚举（类型安全）
     */
    public void updateUserStatus(Long userId, UserStatus status)
    {
        // 使用枚举进行业务逻辑判断
        if (status == UserStatus.OK)
        {
            // 处理正常状态
        }
        
        // 存储时转换为字符串
        SysUser user = new SysUser();
        user.setStatus(status.getCode());
        userMapper.updateUser(user);
    }
    
    /**
     * 前端展示使用字典（可配置）
     */
    public Map<String, Object> getUserInfo(Long userId)
    {
        SysUser user = userMapper.selectUserById(userId);
        Map<String, Object> result = new HashMap<>();
        
        // 状态使用枚举获取代码值
        result.put("status", user.getStatus());
        
        // 状态标签使用字典获取（支持多语言、样式等）
        result.put("statusLabel", DictUtils.getDictLabel("sys_user_status", user.getStatus()));
        
        // 性别使用字典（完全可配置）
        result.put("sex", user.getSex());
        result.put("sexLabel", DictUtils.getDictLabel("sys_user_sex", user.getSex()));
        
        return result;
    }
}
```

### 4.7 最佳实践

1. **业务逻辑层**：优先使用枚举，保证类型安全和代码可读性
2. **数据持久层**：存储枚举的代码值（String 类型）
3. **展示层**：使用字典获取标签，支持动态配置和样式
4. **验证层**：使用枚举验证输入值的有效性
5. **配置层**：使用字典管理可配置的业务选项

### 4.8 字典与枚举对应关系示例

| 字典类型 | 字典用途 | 是否对应枚举 | 枚举类名 |
|---------|---------|------------|---------|
| `sys_user_sex` | 用户性别（可配置） | ❌ 否 | - |
| `sys_user_status` | 用户状态（固定） | ✅ 是 | `UserStatus` |
| `sys_oper_type` | 操作类型（固定） | ✅ 是 | `BusinessType` |
| `order_status` | 订单状态（可配置） | ❌ 否 | - |
| `sys_normal_disable` | 系统开关（固定） | ✅ 是 | `BusinessStatus` |

## 5. 最佳实践

### 5.1 枚举设计原则

1. **单一职责**：一个枚举只表示一种业务概念
2. **不可变**：枚举值一旦定义，不应随意修改
3. **完整性**：枚举应包含所有可能的值
4. **文档化**：每个枚举值都应添加注释说明

### 5.2 性能考虑

- 枚举比较使用 `==` 而不是 `equals()`
- 带值的枚举提供静态查找方法，避免循环查找

### 5.3 扩展性

- 如需扩展枚举值，考虑向后兼容性
- 废弃的枚举值使用 `@Deprecated` 标记

## 6. 常见问题

### 6.1 枚举序列化

在 JSON 序列化时，枚举默认序列化为名称字符串。如需序列化为代码值：

```java
@JsonValue
public String getCode()
{
    return code;
}
```

### 6.2 枚举与数据库映射

- 数据库字段通常存储字符串类型（VARCHAR）
- 实体类中使用 String 类型存储枚举代码值
- 提供转换方法在枚举和字符串之间转换

### 6.3 枚举国际化

如需支持多语言，可在枚举中添加国际化键：

```java
public enum UserStatus
{
    OK("0", "user.status.ok"),  // 国际化键
    DISABLE("1", "user.status.disable");
    
    // 通过 MessageSource 获取国际化文本
}
```

## 7. 示例参考

项目中的枚举示例：

- `BusinessType` - 业务操作类型
- `UserStatus` - 用户状态
- `OperatorType` - 操作类型
- `HttpMethod` - HTTP 方法
- `LimitType` - 限流类型
- `DesensitizedType` - 脱敏类型
- `DataSourceType` - 数据源类型







